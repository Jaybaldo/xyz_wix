<!DOCTYPE html>

<html lang="en-US">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />

    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.css" type="text/css">
    <link rel="stylesheet" href="assets/css/bootstrap-select.min.css" type="text/css">
    <link rel="stylesheet" type="text/css" href="css/activity_modular.css">
    <link rel="stylesheet" type="text/css" href="css/slider_main.css">

    <link rel="stylesheet" type="text/css" href="assets/slick/slick/slick.css">
    <link rel="stylesheet" type="text/css" href="assets/slick/slick/slick-theme.css">

    <link rel="stylesheet" href="assets/powerange/powerange.css" />

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/rateYo/2.3.2/jquery.rateyo.min.css">


    <script type="text/javascript" src="assets/js/jquery-3.2.1.min.js"></script>

    <!--<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false&amp;libraries=places"></script>-->

    <script type="text/javascript" src="assets/js/jquery-migrate-1.2.1.min.js"></script>
    <script type="text/javascript" src="assets/bootstrap/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script type="text/javascript" src="assets/js/bootstrap-select.min.js"></script>


    <script type="text/javascript" src="assets/js/jquery.hotkeys.js"></script>
    <script type="text/javascript" src="assets/js/jquery.nouislider.all.min.js"></script>

    <script type="text/javascript" src="js/jquery.cookie.js"></script>
    <script type="text/javascript" src="js/cookiesManager.js"></script>
    <script type="text/javascript" src="js/table_ajax.js"></script>
    <script type="text/javascript" src="js/modalGenerator.js"></script>
    <script type="text/javascript" src="js/modalToggle.js"></script>
    <!--
    <script type="text/javascript" src="js/jqueryvalidate/dist/jquery.validate.min.js"></script>
    <script type="text/javascript" src="js/validate.js"></script>
    -->
    <script type="text/javascript" src="js/openPage.js"></script>
    <script type="text/javascript" src="js/activities_general_loader.js"></script>
    <script src="assets/slick/slick/slick.js" type="text/javascript" charset="utf-8"></script>
    <script defer src="https://use.fontawesome.com/releases/v5.0.6/js/all.js"></script>

    <script src="assets/powerange/powerange.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/rateYo/2.3.2/jquery.rateyo.min.js"></script>

    <title>Wixplor</title>
    <link rel="icon" href="assets/icons/favicon.png" type="image/gif" sizes="16x16">

    <style media="screen">

        .range-handle{
            top: -7px!important;
            width: 15px!important;
            height: 15px!important;
        }
        .range-handle:hover{
            cursor: pointer;
        }

        @media (max-width: 767px) {

            .activities_filler{
                padding-right: 28px;
                margin-top:20px;
            }
            .activity_container{
                width: 100%!important;
                float: left!important;
                margin-left: 5px!important;
                margin-right: 0!important;
                margin-top: 0!important;
                margin-bottom: 0!important;
                padding: 0!important;
            }
            .sidebar-filters{
                width: 80%;
                margin-left: 10%;
            }
            .item-specific{
                font-size: 1em!important;
            }
        }

        @media (min-width: 767px) {
            .filter-activate{
                display: none;
            }
        }
        .filter-activate:hover{
            cursor: pointer;
            background-color: #EFEFEF;
        }
        .filter-deactivate:hover{
            cursor: pointer;
        }

        .bdy > li{
            margin-bottom: 5px;
        }

        .range-quantity{
            background-color: #9496a2;
        }

        .range-handle{
            border:1px solid #9496a2;
            box-shadow: 0px 0px 0 rgba(0, 0, 0, 0.4)
            top: -5px!important;
        }

        #reestablecer:hover{
            cursor: pointer;
        }



    </style>

    <script type="text/javascript">
        function switch_language(){

        }
    </script>

</head>

<body id="bdy" style="display:none;">
<!-- Outer Wrapper-->

    <section>
        <div id="Banner">
            <div id="NavbarOP">

            </div>

            <script type="text/javascript">
                $("#NavbarOP").load('navbar.html', function(){
                    /*NAVBAR **********************************************************/
                    navbar_white();
                    $("#navbar_select_city_div").removeClass("hidden");
                    $("#navbar_select_city_div").addClass("invited explorer wixer_1");

                    $.getScript("js/jqueryvalidate/dist/jquery.validate.min.js");
                    $.getScript("js/validate.js");
                    /*NAVBAR **********************************************************/

                    /*FOOTER **********************************************************/
                    $("#myFooter").load('footer.html', function(){

                    });
                    /*FOOTER **********************************************************/
                });
            </script>

        </div>
    </section>

    <section class="container" style="margin-top:50px">

        <div class="row filter-activate" style="border-bottom:1px solid #CACACA; padding: 0">
            <div class="col-xs-12" style="margin: 10px 0; color: rgb(102, 102, 102); padding: 0 20px;" >
                <i class="filter-icon fas fa-sliders-h" style="float:left"></i>
                <h4 style="margin: 0; padding-left: 5px; float: left"><span class="es">Filtros</span><span class="en hidden">Filters</span></h4>
            </div>
        </div>

        <div class="row">
            <div class="col-sm-3 col-xs-12 sidebar-filters" id="filter">

                    <div class="col-xs-12" style="border-bottom:1px solid #CACACA; padding: 0px;margin-bottom: 20px ">
                        <div class="col-xs-2 filter-deactivate" style="padding:0">
                            <h3>X</h3>
                        </div>
                        <div class="col-xs-6" style="padding:0; color: rgb(129, 129, 129);">
                            <h3 class="es"><!--<img class="filtericon-in-filter" src="assets/img/filtros.png" style="margin-right:10px; margin-bottom: 5px;width: 15px; height: 15px;">-->Filtros</h3>
                            <h3 class="en hidden">Filters</h3>
                        </div>
                        <div class="col-xs-4" style="top:25px; font-size: 1em; padding:0" id="reestablecer">
                            <span class="es" >Reestablecer</span>
                            <span class="en hidden">Reset</span>
                        </div>
                    </div>

                    <div number-checked="0" class="col-xs-12 categories-in-filter" style="margin-bottom:7px">
                        <ul style="padding-left: 0;" id="categories-container-op">
                            <span style="color: #CC9340; font-weight: bolder">Categorias</span>

                            <div id="categoriesBD">
                            </div>

                            <script type="text/javascript">

                            </script>
                        </ul>
                    </div>

                    <div class="col-xs-12 slider-price-range">

                        <div style="margin-bottom:30px; color: #CC9340; font-weight: bolder">
                            <span class="es">Precio (por persona)</span><span class="en hidden">Price Range (per person)</span>
                        </div>

                        <div class="slider-wrapper">
                          <input type="text" class="js-min-max-start" />
                        </div>

                        <div id="slider-value" style="margin-top:20px"></div>

                    </div>

                    <div class="col-xs-12 language-settings-filter" style="margin-top:30px">
                        <span class="es" style="color: #CC9340; font-weight: bolder" >Idioma</span><span class="en hidden" style="color: #CC9340; font-weight: bolder" >Language</span>
                            <li class="filter-li" style="list-style-type: none; margin-top:10px">Español<input id="lang_2" class="es-lang-check lang-check" type="checkbox" style="float:right;" /></li>
                            <li class="filter-li" style="list-style-type: none; margin-top:10px">English<input id="lang_1" class="en-lang-check lang-check" type="checkbox" style="float:right;" /></li>

                        </ul>
                    </div>

                    <div class="col-xs-12 language-settings-filter" style="margin-top:30px">
                        <span class="es" style="color: #CC9340; font-weight: bolder">Tipo de reserva</span><span class="en hidden" style="color: #CC9340; font-weight: bolder">Reservation filters</span>
                        <ul style="padding-left: 0">
                            <li class="filter-li" style="list-style-type: none; margin-top:10px"><span class="es">Reserva inmediata</span> <span class="en hidden">Automatic reservation</span><input class="atuomatic-reserve" type="checkbox" style="float:right;" /></li>
                        </ul>
                    </div>

                    <script type="text/javascript">

                        var changeInput = document.querySelector('.js-min-max-start');
                        changeInput.onchange = function() {
                            document.getElementById('slider-value').innerHTML = "$0.00 a $"+changeInput.value;
                            $("#slider-value").attr("value", changeInput.value);
                        };

                    </script>

                    <div class="col-xs-12 button-apply filter-deactivate" style="margin-top:20px">
                        <button class="btn btn-block btn-primary"><span class="es">Aplicar</span><span class="en hidden">Apply</span></button>
                    </div>

            </div>






            <style media="screen">
                @media (min-width: 768px) {
                    .scrollbar{
                        overflow: auto;
                        max-height:650px;
                    }

                    .style-scrollbar-1::-webkit-scrollbar-track{
                    	-webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.3);
                    	border-radius: 10px;
                    	background-color: #F5F5F5;
                    }

                    .style-scrollbar-1::-webkit-scrollbar{
                    	width: 12px;
                    	background-color: #F5F5F5;
                    }

                    .style-scrollbar-1::-webkit-scrollbar-thumb{
                    	border-radius: 10px;
                    	-webkit-box-shadow: inset 0 0 6px rgba(0,0,0,.3);
                    	background-color: #555;
                    }
                }

            </style>



            <div class="col-sm-9 col-xs-12 activities_filler ">

            </div>
        </div>
    </section>

    <br>

    <div id="myFooter"></div>
<script>

    $(".filter-li").click(function () {
        $("input",this).click();
    });


    var getUrlParameter = function getUrlParameter(sParam) {
        var sPageURL = decodeURIComponent(window.location.search.substring(1)),
            sURLVariables = sPageURL.split('&'),
            sParameterName,
            i;

        for (i = 0; i < sURLVariables.length; i++) {
            sParameterName = sURLVariables[i].split('=');

            if (sParameterName[0] === sParam) {
                return sParameterName[1] === undefined ? true : sParameterName[1];
            }
        }
    };




    $(document).ready(function () {

        var city = getUrlParameter('city');
        if(city==undefined){
            city = "null";
        }

        function start_filtering(caso, element) {
            $(".activities_filler").empty();

            var dataPHP_filtered;
            switch (caso){
                case 1:     //Categorías
                    chekedboxes_ids="";
                    $('.cat-checkbox:checked').each( function() {
                        chekedboxes_ids = chekedboxes_ids + $(this).attr('id') + ",";
                    });
                    if(chekedboxes_ids == ""){
                        chekedboxes_ids = "null";
                    }
                    else{
                        chekedboxes_ids = chekedboxes_ids.substring(0,chekedboxes_ids.length-1);
                    }
                break;

                case 2:     //Precio
                    price = element;
                break;

                case 3:     //Idioma
                    lang_filter = "";
                    $('.lang-check:checked').each( function() {
                        var tmp = $(this).attr('id');
                        tmp = tmp.substring(5,tmp.length);
                        console.log(tmp);
                        lang_filter = lang_filter + tmp + ",";
                    });
                    if(lang_filter == ""){
                        lang_filter = "null";
                    }
                    else{
                        lang_filter = lang_filter.substring(0,lang_filter.length-1);
                    }
                break;

                case 4:     //Tipo_Reserva
                    if(element){
                        reservation = "automatic";
                    }
                    else{
                        reservation = "dont-care";
                    }
                break;
            }

            dataPHP_filtered = {'status':'ACEPTADO','case':8,
                                'categories':chekedboxes_ids,
                                'city':city, 'price':price,
                                'lang':lang_filter,
                                'reservation':reservation,
                                'status':'ACEPTADO'};

            var data_2 = new Array();
            data_2[0] = $(".activities_filler");
            //data_2[1] =  {'width':'30%','float':'left', 'margin-left':'5px', 'margin-right':'5px'};
            data_2[1] =  {'margin':0, "padding-right": "15px", "padding-left": "15px"};
            data_2[2] = 'activity_container col-xs-12 col-sm-4';
            ajax_activity(dataPHP_filtered, activities_general_loader, data_2);

        }

        var chekedboxes_ids="null";
        var price=4000;
        var lang_filter = "null";
        var reservation = "null";


        /*Check what city is being asked*/

            if(city != "null"){var dataPHP = {'case':4, 'id':city, 'status':'ACEPTADO'};}
            else{var dataPHP = {'case':1, 'status':'ACEPTADO'};}
            var data = new Array();
            data[0] = $(".activities_filler");
            data[1] =  {'margin':0, "padding-right": "15px", "padding-left": "15px"};
            data[2] = 'activity_container col-xs-12 col-sm-4';
            data[3] = false;
            data[4] = false;
            data[5] = "getAllFavs";
            data[6] = "activities_filler";
            ajax_activity(dataPHP, activities_general_loader, data);
        /*Check what city is being asked*/

        /*Start powerange slider*/
            var vals = document.querySelector('.js-min-max-start');
            var initVals = new Powerange(vals, { min: 0, max: 4000, start: 4000, decimal: true, hideRange: true });
        /*Start powerange slider*/


        /*Restablecer*/
            $("#reestablecer").click(function () {
                $(".activities_filler").empty();
                chekedboxes_ids="null";
                price=4000;
                lang_filter = "null";
                reservation = "null";
                if(city != "null"){var dataPHP_rest = {'case':4, 'id':city, 'status':'ACEPTADO'};}
                else{var dataPHP_rest = {'case':1, 'status':'ACEPTADO'};}
                var data_rest = new Array();
                data_rest[0] = $(".activities_filler");
                data_rest[1] =  {'margin':0, "padding-right": "15px", "padding-left": "15px"};
                data_rest[2] = 'activity_container col-xs-12 col-sm-4';
                data_rest[3] = false;
                data_rest[4] = false;
                data_rest[5] = "getAllFavs";
                data_rest[6] = "activities_filler";
                ajax_activity(dataPHP_rest, activities_general_loader, data_rest);



                $(".sidebar-filters").find("input.cat-checkbox:checked").each(function() {
                    $(this).prop('checked', false);
                });

                $(".sidebar-filters").find("input.lang-check:checked").each(function() {
                    $(this).prop('checked', false);
                })

                $(".sidebar-filters").find("input.atuomatic-reserve:checked").each(function() {
                    $(this).prop('checked', false);
                })
            });


        /*Reestablecer*/




        /*Load current categories*/
            function loadCategories(json, data) {
                for (var i = 0; i < json.length; i++) {
                    var category = json[i];

                    var li = document.createElement('li');
                        $(li).addClass("filter-li");
                        $(li).css({"list-style-type": "none","margin-top":"10px"})

                        var span_es = document.createElement('span');
                            $(span_es).addClass('es');
                        var span_en = document.createElement('span');
                            $(span_en).addClass('en');
                            $(span_en).addClass('hidden');
                        var inputed = document.createElement('input');
                            $(inputed).attr('id',category.id);
                            $(inputed).attr('type','checkbox');
                            $(inputed).addClass('cat-checkbox');
                            $(inputed).attr('name_spa', category.name_spa);
                            $(inputed).attr('name_eng',category.name_eng);
                            $(inputed).attr('description_eng',category.description_eng);
                            $(inputed).attr('description_spa',category.description_spa);
                            $(inputed).css({"float":"right"});
                            $(inputed).click(function(e){
                                e.stopPropagation();
                                start_filtering(1,$(this));
                            });

                        $(span_es).append(category.name_spa);
                        $(li).append(span_es);

                        $(span_en).append(category.name_eng);
                        $(li).append(span_en);

                        $(li).append(inputed);
                    $('#categories-container-op').append(li);
                }
            }

            var dataPHP = {'case':1}
            ajax_category(dataPHP,loadCategories,null);
        /*Load current categories*/


        /*
        $("body").bind("touchstart", function () {

            $('body').find('span.range-handle').on('click',function(){
                start_filtering(2, $("#slider-value").attr("value"))
            });

        });
        */

        var isDragging = false;

        $(".range-handle").mousedown(function() {isDragging = false;}).mousemove(function() {isDragging = true;});

        $("body").mouseup(function() {
            var wasDragging = isDragging;
            isDragging = false;
            if (wasDragging) {
                start_filtering(2, $("#slider-value").attr("value"))
            }
        });


        var mov_isDragging = false

        $(".range-handle").bind("touchstart",function(){
            mov_isDragging = false;
        });

        $(".range-handle").bind("touchmove",function() {
            mov_isDragging = true;
        });

        $("body").bind("touchend",function() {
            var wasDragging = mov_isDragging;
            mov_isDragging = false;
            if (wasDragging) {
                start_filtering(2, $("#slider-value").attr("value"))
            }
        });



        $('.lang-check').click(function (e) {
            e.stopPropagation();
            start_filtering(3,$(this).attr('id'));
        });

        $('.atuomatic-reserve').click(function (e) {
            e.stopPropagation();
            start_filtering(4,$(this).is(":checked"));
        })


        $('body').fadeIn(3000);

    });


    /*Page visual confs*/
        function visual_integrity_window() {
            if ($(window).innerWidth() <= 768){
                if(!$(".sidebar-filters").hasClass("toggled-by-filter-activate")){
                    $(".sidebar-filters").addClass('hidden');
                }
                if(!$(".filter-deactivate").hasClass('toggled-by-filter-activate')){
                    $(".filter-deactivate").removeClass('hidden');
                }
                if(!$(".filter-deactivate").hasClass('toggled-by-filter-activate')){
                    $(".filter-deactivate").remove('hidden');
                }
            }
            else{
                if(!$(".filter-deactivate").hasClass('toggled-by-filter-activate')){
                    $(".filter-deactivate").addClass('hidden');
                }

                if(!$(".sidebar-filters").hasClass("toggled-by-filter-activate")){
                    $(".sidebar-filters").removeClass('hidden');
                }
                if(!$(".filter-deactivate").hasClass('toggled-by-filter-activate')){
                    $(".filter-deactivate").addClass('hidden');
                }
            }
        }

        visual_integrity_window();

        window.onresize = function() {
            if (window.innerWidth <= 768){
                if(!$(".sidebar-filters").hasClass("toggled-by-filter-activate")){
                    $(".sidebar-filters").addClass('hidden');
                }
                if(!$(".filter-deactivate").hasClass('toggled-by-filter-activate')){
                    $(".filter-deactivate").removeClass('hidden');
                }
                if(!$(".filter-deactivate").hasClass('toggled-by-filter-activate')){
                    $(".filter-deactivate").removeClass('hidden');
                }

            }
            else{
                if(!$(".filter-deactivate").hasClass('toggled-by-filter-activate')){
                    $(".filter-deactivate").addClass('hidden');
                }

                if(!$(".sidebar-filters").hasClass("toggled-by-filter-activate")){
                    $(".sidebar-filters").removeClass('hidden');
                }
                if(!$(".filter-deactivate").hasClass('toggled-by-filter-activate')){
                    $(".filter-deactivate").addClass('hidden');
                }

            }
        }

        $(".filter-activate").click(function () {
            $(this).addClass('hidden');
            $(this).addClass('toggled-by-filter-activate');
            $(".sidebar-filters").removeClass('hidden');
            $(".sidebar-filters").addClass("toggled-by-filter-activate");
            $('body').find(".activities_filler").addClass('hidden');
            $('body').find("footer#page-footer").addClass('hidden');
            $(".filter-deactivate").addClass('toggled-by-filter-activate');
            $(".filter-icon").addClass('hidden');
            $(".filter-deactivate").addClass('toggled-by-filter-activate');
        });

        $(".filter-deactivate").click(function () {
            $(".filter-activate").removeClass('hidden');
            $(".filter-activate").removeClass('toggled-by-filter-activate');
            $(".sidebar-filters").addClass('hidden');
            $(".sidebar-filters").removeClass("toggled-by-filter-activate");
            $('body').find(".activities_filler").removeClass('hidden');
            $('body').find("footer#page-footer").removeClass('hidden');
            $(".filter-deactivate").removeClass('toggled-by-filter-activate');
            $(".filter-icon").removeClass('hidden');
            $(".filter-deactivate").removeClass('toggled-by-filter-activate');

            visual_integrity_window();
        });
    /*Page visual confs*/

</script>

<!--[if lte IE 9]>
<script type="text/javascript" src="assets/js/ie-scripts.js"></script>
<![endif]-->
</body>
</html>
